# ============================================
# APPLICATION PROPERTIES - PRODUCTION
# ============================================
# Use: export QUARKUS_PROFILE=prod && java -jar target/workflow-engine-1.0.0-SNAPSHOT.jar

# ============================================
# DATABASE CONFIGURATION
# ============================================
quarkus.datasource.jdbc.url=${DB_JDBC_URL}
quarkus.datasource.username=${DB_USERNAME}
quarkus.datasource.password=${DB_PASSWORD}
quarkus.datasource.jdbc.initial-size=${DB_INITIAL_SIZE:10}
quarkus.datasource.jdbc.max-size=${DB_MAX_SIZE:50}

# JWT Configuration
mp.jwt.verify.publickey.location=${SUPABASE_URL}/auth/v1/certs
mp.jwt.verify.issuer=${JWT_ISSUER:https://rpkqbesfgjdeolketoug.supabase.co}
mp.jwt.verify.audiences=${JWT_AUDIENCE:authenticated}
quarkus.smallrye-jwt.enabled=true

# Connection Pooling
quarkus.datasource.jdbc.validation-query=SELECT 1
quarkus.datasource.jdbc.idle-removal-interval=5M
quarkus.datasource.jdbc.max-lifetime=30M

# Hibernate Configuration
quarkus.hibernate-orm.database.generation=validate
quarkus.hibernate-orm.log.sql=false
# CORREÇÃO CRÍTICA: Resolve erro de serialização JSON
quarkus.hibernate-orm.mapping.format.global=ignore

# Quarkus Application
quarkus.application.name=workflow-service
quarkus.application.version=1.0.0

# Server Configuration
quarkus.http.port=${SERVER_PORT:8080}
quarkus.http.ssl.certificate.files=${SSL_CERT_PATH:}
quarkus.http.ssl.certificate.key-files=${SSL_KEY_PATH:}

# Logging - Production (MÍNIMO)
quarkus.log.level=INFO
quarkus.log.category."com.apporte".level=INFO
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{2.}] (%t) %s%e%n
# CORREÇÃO: Usar propriedades corretas para log em arquivo
quarkus.log.file.enable=true
quarkus.log.file.path=/var/log/workflow/app.log
quarkus.log.file.format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{2.}] (%t) %s%e%n
quarkus.log.file.rotation.max-file-size=10M
quarkus.log.file.rotation.max-backup-index=10

# CORS Configuration (production - específico)
quarkus.http.cors=true
quarkus.http.cors.origins=${CORS_ORIGINS:https://app.production.com}
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=Content-Type,Authorization,X-API-Key

# Security Headers
quarkus.http.header.X-Content-Type-Options=nosniff
quarkus.http.header.X-Frame-Options=DENY
quarkus.http.header.X-XSS-Protection=1;mode=block
quarkus.http.header.Strict-Transport-Security=max-age=31536000; includeSubDomains

# Health Checks
quarkus.health.enabled=true
quarkus.smallrye-health.root-path=/q/health

# Metrics
quarkus.micrometer.enabled=true
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/q/metrics

# Jackson Configuration
quarkus.jackson.serialization-inclusion=NON_NULL
quarkus.jackson.write-dates-as-timestamps=false

# External Service Configuration
workflow.api.url=${WORKFLOW_API_URL:http://api.production.com}
notification.service.url=${NOTIFICATION_SERVICE_URL:http://notify.production.com}

# Timeout Configuration
quarkus.http.limits.max-body-size=1M
quarkus.http.so-reuse-address=true

# Performance
quarkus.native.gc=epsilon
quarkus.native.enable-vm-fault-isolation=false

# ============================================
# KEYCLOAK OIDC CONFIGURATION
# ============================================
quarkus.oidc.auth-server-url=${KEYCLOAK_AUTH_SERVER_URL:https://auth.apporte.work/realms/production}
quarkus.oidc.client-id=${KEYCLOAK_CLIENT_ID:workflow-engine-prod}
quarkus.oidc.credentials.secret=${KEYCLOAK_CLIENT_SECRET}

# Token configuration
quarkus.oidc.token.issuer=${KEYCLOAK_ISSUER:https://auth.apporte.work/realms/production}
quarkus.oidc.token.audience=account

# Roles mapping
quarkus.oidc.roles.source=accesstoken
quarkus.oidc.roles.role-claim-path=realm_access/roles

# Security (mais restritivo em produção)
quarkus.oidc.tls.verification=required
quarkus.http.auth.permission.authenticated.paths=/*
quarkus.http.auth.permission.authenticated.policy=authenticated
quarkus.http.auth.permission.public.paths=/q/health/*,/q/metrics
quarkus.http.auth.permission.public.policy=permit