# ============================================
# APPLICATION PROPERTIES - DEVELOPMENT
# ============================================
# Use: ./mvnw quarkus:dev

# ============================================
# DATABASE CONFIGURATION - Supabase via Pooler (Transaction Mode)
# ============================================
quarkus.datasource.jdbc.url=${DB_JDBC_URL:jdbc:postgresql://db.rpkqbesfgjdeolketoug.supabase.co:5432/postgres?sslmode=require}
quarkus.datasource.username=${DB_USERNAME:workflow_backend}
quarkus.datasource.password=${DB_PASSWORD}
quarkus.datasource.jdbc.initial-size=${DB_INITIAL_SIZE:5}
quarkus.datasource.jdbc.max-size=${DB_MAX_SIZE:20}

# Hibernate Configuration - CORREÇÃO: Remover propriedades depreciadas
quarkus.hibernate-orm.database.generation=update
quarkus.hibernate-orm.log.sql=true
quarkus.hibernate-orm.log.bind-param=true
# CORREÇÃO CRÍTICA: Resolve erro de serialização JSON
quarkus.hibernate-orm.mapping.format.global=ignore

# Quarkus Application
quarkus.application.name=workflow-service
quarkus.application.version=1.0.0

# Server Configuration
quarkus.http.port=8080
quarkus.http.test-port=8081

# Logging - Desenvolvimento (MAIS DETALHADO)
quarkus.log.level=DEBUG
quarkus.log.category."com.apporte".level=DEBUG
quarkus.log.category."io.quarkus".level=INFO
quarkus.log.category."org.hibernate".level=DEBUG
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n
# CORREÇÃO: Desabilitar log em arquivo em dev (causa problema)
quarkus.log.file.enable=false

# CORS Configuration (desenvolvimento)
quarkus.http.cors=true
quarkus.http.cors.origins=http://localhost:3000,http://localhost:3001
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=Content-Type,Authorization

# Health Checks
quarkus.health.enabled=true
quarkus.smallrye-health.root-path=/q/health

# Metrics (desabilitado em dev para performance)
quarkus.micrometer.enabled=false

# Development Features - CORREÇÃO: Usar propriedade correta
quarkus.devservices.enabled=false
quarkus.live-reload.instrumentation=true

# Jackson Configuration
quarkus.jackson.serialization-inclusion=NON_NULL
quarkus.jackson.write-dates-as-timestamps=false

# ============================================
# KEYCLOAK OIDC CONFIGURATION
# ============================================
quarkus.oidc.auth-server-url=${KEYCLOAK_AUTH_SERVER_URL:https://auth.apporte.work/realms/development}
quarkus.oidc.client-id=${KEYCLOAK_CLIENT_ID:workflow-engine-dev}
quarkus.oidc.credentials.secret=${KEYCLOAK_CLIENT_SECRET}

# Token configuration
quarkus.oidc.token.issuer=https://auth.apporte.work/realms/development
quarkus.oidc.token.audience=account

# Roles mapping
quarkus.oidc.roles.source=accesstoken
quarkus.oidc.roles.role-claim-path=realm_access/roles

# Security
quarkus.oidc.tls.verification=required
quarkus.http.auth.permission.authenticated.paths=/*
quarkus.http.auth.permission.authenticated.policy=authenticated
quarkus.http.auth.permission.public.paths=/q/health/*,/q/metrics
quarkus.http.auth.permission.public.policy=permit